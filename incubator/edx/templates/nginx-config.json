{
    "kind": "ConfigMap",
    "apiVersion": "v1",
    "metadata": {
      "name": "nginx-config",
      "namespace": "helm-openedx"
    },
    "data": {
      "cms.conf": "\nupstream cms-backend {\n    server cms:8000 fail_timeout=0;\n}\n\n\n\nserver {\n  listen 80;\n  server_name studio.localhost studio.weijie.com;\n\n  \n\n  client_max_body_size 100M;\n\n  rewrite ^(.*)/favicon.ico$ /static/images/favicon.ico last;\n  \n  # Disables server version feedback on pages and in headers\n  server_tokens off;\n  # Prevent invalid display courseware in IE 10+ with high privacy settings\n  add_header P3P 'CP=\"Open edX does not have a P3P policy.\"';\n\n  location @proxy_to_cms_app {\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_set_header X-Forwarded-Port $server_port;\n    proxy_set_header X-Forwarded-For $remote_addr;\n    proxy_set_header Host $http_host;\n    proxy_redirect off;\n\n    proxy_pass http://cms-backend;\n  }\n\n  location / {\n    try_files $uri @proxy_to_cms_app;\n  }\n\n  location ~ ^/media/(?P<file>.*) {\n    root /openedx/data/cms/uploads;\n    try_files /$file =404;\n    expires 31536000s;\n  }\n\n  location ~ ^/static/(?P<file>.*) {\n    root /var/www/openedx;\n    try_files /staticfiles/$file /course_static/$file =404;\n\n    # return a 403 for static files that shouldn't be\n    # in the staticfiles directory\n    location ~ ^/static/(?:.*)(?:\\.xml|\\.json|README.TXT) {\n      return 403;\n    }\n\n    # Set django-pipelined files to maximum cache time\n    location ~ \"/static/(?P<collected>.*\\.[0-9a-f]{12}\\..*)\" {\n      expires max;\n      try_files /staticfiles/$collected /course_static/$collected =404;\n    }\n    location ~ \"/static/(?P<collected>[0-9a-f]{7}/.*)\" {\n      expires max;\n      try_files /staticfiles/$collected /course_static/$collected =404;\n    }\n\n    # Expire other static files immediately (there should be very few / none of these)\n    expires epoch;\n  }\n}\n",
      "extra.conf": "",
      "lms.conf": "\nupstream lms-backend {\n    server lms:8000 fail_timeout=0;\n}\n\n\n\nserver {\n  listen 80;\n  server_name localhost preview.localhost weijie.com preview.weijie.com;\n\n  \n\n  client_max_body_size 4M;\n\n  rewrite ^(.*)/favicon.ico$ /static/images/favicon.ico last;\n  \n  # Disables server version feedback on pages and in headers\n  server_tokens off;\n  # Prevent invalid display courseware in IE 10+ with high privacy settings\n  add_header P3P 'CP=\"Open edX does not have a P3P policy.\"';\n\n  location @proxy_to_lms_app {\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_set_header X-Forwarded-Port $server_port;\n    proxy_set_header X-Forwarded-For $remote_addr;\n    proxy_set_header Host $http_host;\n    proxy_redirect off;\n\n    proxy_pass http://lms-backend;\n  }\n\n  location / {\n    try_files $uri @proxy_to_lms_app;\n  }\n\n  # /login?next=<any image> can be used by 3rd party sites in <img> tags to\n  # determine whether a user on their site is logged into edX.\n  # The most common image to use is favicon.ico.\n  location /login {\n    if ( $arg_next ~* \"favicon.ico\" ) {\n      return 403;\n    }\n    try_files $uri @proxy_to_lms_app;\n  }\n\n  # Need a separate location for the image uploads endpoint to limit upload sizes\n  location ~ ^/api/profile_images/[^/]*/[^/]*/upload$ {\n    try_files $uri @proxy_to_lms_app;\n    client_max_body_size 1049576;\n  }\n\n  location ~ ^/media/(?P<file>.*) {\n    root /openedx/data/lms/uploads;\n    try_files /$file =404;\n    expires 31536000s;\n  }\n\n  location ~ ^/static/(?P<file>.*) {\n    root /var/www/openedx;\n    try_files /staticfiles/$file /course_static/$file =404;\n\n    # return a 403 for static files that shouldn't be\n    # in the staticfiles directory\n    location ~ ^/static/(?:.*)(?:\\.xml|\\.json|README.TXT) {\n      return 403;\n    }\n\n    # Set django-pipelined files to maximum cache time\n    location ~ \"/static/(?P<collected>.*\\.[0-9a-f]{12}\\..*)\" {\n      expires max;\n      try_files /staticfiles/$collected /course_static/$collected =404;\n    }\n    location ~ \"/static/(?P<collected>[0-9a-f]{7}/.*)\" {\n      expires max;\n      try_files /staticfiles/$collected /course_static/$collected =404;\n    }\n\n    # Expire other static files immediately (there should be very few / none of these)\n    expires epoch;\n  }\n}\n",
      "tutor.conf": "# Allow long domain names\nserver_names_hash_bucket_size 128;"
    }
  }